// Prisma schema for Holiday Email Orchestrator backend
// This schema defines the database models for logging email batches and recipients.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Represents a batch of holiday emails sent to multiple recipients.
/// Each batch corresponds to one form submission in the frontend.
model EmailBatch {
  id           String   @id @default(cuid())
  createdAt    DateTime @default(now())
  
  /// The holiday being celebrated (e.g., "Christmas", "Diwali")
  holidayName  String
  
  /// The tone of the email (e.g., "warm", "formal", "playful")
  tone         String?
  
  /// The audience type ("business" or "personal")
  audienceType String?
  
  /// The language code (e.g., "en", "hi")
  language     String?
  
  /// The name used to sign the email
  senderName   String
  
  /// The status of the batch ("queued", "sent", "error")
  status       String   @default("queued")
  
  /// Error message if status is "error"
  errorMessage String?
  
  /// The recipients of this email batch
  recipients   EmailRecipient[]

  @@index([createdAt])
  @@index([status])
}

/// Represents an individual recipient within an email batch.
model EmailRecipient {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  
  /// The recipient's email address
  email     String
  
  /// The subject line of the email (optional, may be set by n8n)
  subject   String?
  
  /// The batch this recipient belongs to
  batch     EmailBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  batchId   String

  @@index([batchId])
  @@index([email])
}
